# quarkus 간단 후기

[스프링으로 하는 마이크로서비스 구축](http://www.yes24.com/Product/Goods/95593443)의 거의 끝에 나오는 쿠버네티스 관련 내용을 이제야 훑어봤다.  
마이크로서비스를 쿠버네티스 환경으로 이관하면서 다음과 같은 스프링 클라우드 컴포넌트를 대체하는 내용이 나온다.

- Eureka
- Config
- Gateway

애플리케이션 수준에서 구현하던 위 3가지를 인프라 수준인 쿠버네티스로 대체하는 걸 보니, 이젠 마이크로서비스를 정말로 폴리글랏으로 만들 수 있겠다는 생각이 들었다.

물론 스프링 클라우드를 사용해도 폴리글랏은 가능하다. 하지만 아마도 Sidecar라는 걸 또 추가해야 가능한 걸로 알고 있다.

암튼 이젠 **쿠버네티스 인프라 덕분에 꼭 스프링 부트 기반이 아닌 다른 기술 스택을 사용해도 seamless하게 폴리글랏 마이크로서비스를 구현할 수 있다.**

그래서 먼저 살펴본 것이 [쿼커스(quarkus)](https://quarkus.io/)다.

쿼커스는 아래와 같이 소개돼 있다.

>**Supersonic Subatomic Java**
>
>A Kubernetes Native Java stack tailored for OpenJDK HotSpot and GraalVM, crafted from the best of breed Java libraries and standards.

한 마디로 **졸라 빠르고 졸라 작은 자바, 킹왕짱 라이브러리와 표준을 골라서 OpenJDK HotSpot, GraalVM에서 씽씽 돌아가는 k8s 깔맞춤 자바 스택**이란 소리다.

조금 더 쉽게 얘기하자면 **스프링이 아니라 [이클립스 버텍스(vert.x)](https://vertx.io/)를 중심으로 하는 자바 스택**이라고 할 수 있겠다.

일반적인 쿼커스 특징이나 소개는 다른 자료에도 많으니 여기에서는 코틀린, 리액티브, 몽고디비를 사용해서 CRUD도 아니고 CR만 하는 초간단 미니 프로젝트 깔짝대면서 느낀 점을 끄적여본다.


## 지리는 Live Coding

수퍼소닉, 서브아토믹, 클라우드 네이티브, k8s 이런 거창하면서도 비구체적인 수식어에는 사실 큰 감흥이 없었다.  
개발자로서 정말 지리는 포인트는 [Live Coding](https://quarkus.io/vision/developer-joy#live-coding)이었다.

애플리케이션을 dev 모드로 실행하면, 그 이후에 메서드 추가뿐 아니라 클래스를 추가하거나 라이브러리 임포트를 하거나 설정 파일을 수정하거나 등등의 변경 사항이 생겨도 수동으로 애플리케이션을 재시작하지 않아도 변경 부분만 샥 반영돼서 자동으로 재시작 된다. 그런데 이 재시작이 간단 앱에서는 대략 2초 이내로 굉장히 빠르다. [JRebel](https://www.jrebel.com/) 을 쓰는 게 이런 느낌이었을까?


## Reactive

쿼커스는 버텍스 기반이라고 했다. 버텍스는 쉽게 말해 자바판 node.js라고도 알려졌었는데, 스프링보다도 훨씬 이른 시기부터 리액티브 라이브러리임을 표방해왔다. 그래서 리액티브 지원 생태계도 잘 갖춰져 있다.

### Mutiny

스프링에서 사용되는 리액터 대신에 [뮤티니(Mutiny)](https://smallrye.io/smallrye-mutiny)를 사용한다. 리액터의 Flux, Mono 처럼 뮤티니에도 Multi, Uni 가 있는데, 치이점은 리액터의 Flux, Mono 는 둘다 리액티브 스트림의 Publisher 구현체인데 반해, 뮤티니의 Uni는 Publisher 구현체가 아니다. Uni 같은 경우 스트리밍이 아니라 단건단건 똑 떨어지는 결과에만 관심이 있으므로 굳이 복잡한 리액티브 스트림 구조를 따르지 않고 더 간단하게 처리할 수 있게 하기 위해 Publisher를 구현하지 않았다고 한다.

어쨌든 사용하는 입장에서는 리액티브 어쩌구 api는 일반 문장처럼 느껴지는 평문형 api를 제공한다는 미명하에 비즈니스 해결과 무관한 코드량이 불필요하게 너\~\~\~무 많아지는 단점이 있는데 뮤티니도 이런 한계에서 크게 벗어나지는 못한 것 같다. 걍 리액터랑 비슷한 다른 놈이라고 생각하면 된다.

### Mongo Client

### 코루틴 지원





